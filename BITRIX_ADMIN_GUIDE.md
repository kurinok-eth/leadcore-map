# Инструкция для администратора 1С-Битрикс

## Настройка инфоблока

### Необходимые свойства элементов

Для работы компонента в инфоблоке должны быть созданы следующие свойства со **строгими символьными кодами**:

| Название свойства | Символьный код | Тип | Обязательное |
|-------------------|----------------|-----|--------------|
| ID Региона | `REGION_ID` | Строка (или Список) | ✅ Да |
| Телефон | `PHONE` | Строка | ✅ Да |
| E-mail | `EMAIL` | Строка | ✅ Да |
| Должность | `POSITION` | Строка | ✅ Да |
| Адрес | `ADDRESS` | Строка | ❌ Нет |
| Направление деятельности | `ACTIVITY` | Список (множественный) | ❌ Нет |
| График работы | `WORKING_HOURS` | Строка | ❌ Нет |

**⚠️ ВАЖНО:** Символьные коды должны быть **ТОЧНО** такими, как указано в таблице выше (с заглавными буквами и подчеркиваниями). Иначе данные не будут передаваться в React-приложение!

### Настройка свойства "Направление деятельности"

Если вы используете свойство `ACTIVITY`, создайте список со следующими значениями:

- Лабораторное
- Эфферентные методы
- Служба крови
- Госпитальное

Свойство должно быть **множественным**, чтобы представитель мог иметь несколько направлений.

---

## Настройка представителей в инфоблоке

### Поле "ID Региона" (REGION_ID) — правильные коды

В поле **"ID Региона"** необходимо использовать следующие коды:

#### Федеральные округа (для представителя на весь округ):

- `ЦФО` — Центральный федеральный округ
- `СЗФО` — Северо-Западный федеральный округ
- `ЮФО` — Южный федеральный округ
- `СКФО` — Северо-Кавказский федеральный округ
- `ПФО` — Приволжский федеральный округ
- `УФО` — Уральский федеральный округ
- `СФО` — Сибирский федеральный округ
- `ДФО` — Дальневосточный федеральный округ

#### Конкретные регионы (примеры):

- `RU-MOW` — Москва
- `RU-SPE` — Санкт-Петербург
- `RU-KDA` — Краснодарский край
- `RU-KYA` — Красноярский край
- `RU-SVE` — Свердловская область
- `RU-DPR` — Донецкая Народная Республика
- `RU-LPR` — Луганская Народная Республика
- `RU-ZPR` — Запорожская область
- `RU-KHE` — Херсонская область

Полный список кодов регионов можно найти в файле `src/constants.ts`

### Примеры заполнения элементов инфоблока

**Пример 1:** Представитель на весь Центральный федеральный округ
```
Название элемента: Иванов Иван Иванович
Свойства:
  - E-mail (EMAIL): IvanovII@leadcore.ru
  - Телефон (PHONE): +7 913 384 35 50
  - ID Региона (REGION_ID): ЦФО
  - Должность (POSITION): Региональный менеджер
```

**Пример 2:** Представитель в конкретном регионе
```
Название элемента: Петров Петр Петрович
Свойства:
  - E-mail (EMAIL): PetrovPP@leadcore.ru
  - Телефон (PHONE): +7 912 345 67 89
  - ID Региона (REGION_ID): RU-KYA
  - Должность (POSITION): Менеджер по продажам
```

**Пример 3:** Представитель в нескольких округах
```
Название элемента: Сидорова Анна Сергеевна
Свойства:
  - E-mail (EMAIL): SidorovaAS@leadcore.ru
  - Телефон (PHONE): +7 863 111 22 33
  - ID Региона (REGION_ID): ЦФО,СЗФО
  - Должность (POSITION): Территориальный менеджер
  - Направление деятельности (ACTIVITY): Лабораторное, Госпитальное
```

### Важно!

1. **Не используйте полные названия** округов в поле "ID Региона"
   - ❌ НЕПРАВИЛЬНО: "Центральный федеральный округ"
   - ✅ ПРАВИЛЬНО: `ЦФО`

2. **Коды регионов должны быть точными** (соблюдайте регистр)
   - ❌ НЕПРАВИЛЬНО: `ru-mow`, `RU-mow`
   - ✅ ПРАВИЛЬНО: `RU-MOW`

3. **Телефон и почта обязательны** для отображения на карте
   - Если не заполнены — представитель появится, но без контактной информации

4. **Множественные округа** — для представителя, работающего в нескольких округах, укажите коды через запятую:
   ```
   REGION_ID: ЦФО,СЗФО
   ```

5. **Символьные коды свойств критичны!** Убедитесь, что в настройках инфоблока символьные коды свойств совпадают:
   - ❌ НЕПРАВИЛЬНО: `region_id`, `Region_Id`, `RegionId`
   - ✅ ПРАВИЛЬНО: `REGION_ID` (все заглавными, с подчеркиванием)

### Как проверить правильность настройки

1. Откройте карту на сайте
2. Если указан федеральный округ (например, `ЦФО`):
   - Представитель должен отображаться **во всех регионах** этого округа
3. Если указан конкретный регион (например, `RU-MOW`):
   - Представитель отображается **только в этом регионе**
4. В списке (кнопка "СПИСОК") можно найти представителя через поиск

### Частые ошибки

| Проблема | Причина | Решение |
|----------|---------|---------|
| Представитель не виден на карте | Неправильный код региона | Проверить код по списку выше |
| Нет телефона/почты | Поля не заполнены | Заполнить поля в инфоблоке |
| Не виден во всем округе | Вместо `ЦФО` указан конкретный регион | Изменить на код округа |
| Виден в лишних регионах | Указан округ вместо конкретного региона | Изменить на код региона `RU-XXX` |
| Данные не загружаются | Неправильные символьные коды свойств | Проверить `component.php` и коды свойств |

---

## Установка компонента в Битрикс

### Структура файлов на сервере

```
/local/components/custom/russia.map/
├── .description.php          # Регистрация компонента
├── component.php             # Логика загрузки данных из инфоблока
└── templates/
    └── .default/
        ├── template.php              # HTML-шаблон (без DOCTYPE/html/body!)
        ├── script.js                 # React-бандл (из dist/)
        ├── style.css                 # Стили (из dist/)
        └── russia-regions.geojson    # Геометрия регионов (из public/)
```

### Шаги установки

1. **Скопировать файлы примера:**
   - Файлы из папки `bitrix-component-example/` скопировать в `/local/components/custom/russia.map/`

2. **Скопировать собранные файлы:**
   ```bash
   # На локальной машине выполнить сборку
   npm run build

   # Скопировать на сервер:
   dist/script.js  → /local/components/custom/russia.map/templates/.default/script.js
   dist/style.css  → /local/components/custom/russia.map/templates/.default/style.css
   public/russia-regions.geojson → /local/components/custom/russia.map/templates/.default/russia-regions.geojson
   ```

3. **Настроить component.php:**
   - Открыть `/local/components/custom/russia.map/component.php`
   - Найти строку `$iblockId = 0;`
   - Заменить `0` на **ID вашего инфоблока** с представителями

4. **Вставить компонент на страницу:**
   ```php
   <?php
   $APPLICATION->IncludeComponent(
       "custom:russia.map",
       ".default",
       [],
       false
   );
   ?>
   ```

### Проверка установки

После установки откройте страницу с компонентом и проверьте:

1. ✅ Карта загружается без ошибок в консоли браузера (F12)
2. ✅ При наведении на регион появляется подсветка и тултип
3. ✅ При клике на регион открывается панель с представителями
4. ✅ Контакты (телефон, email) отображаются и являются кликабельными
5. ✅ Переключатель "КАРТА" / "СПИСОК" работает

Если что-то не работает — проверьте консоль браузера (F12 → Console) на наличие ошибок JavaScript.
